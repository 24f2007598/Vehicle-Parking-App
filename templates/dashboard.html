<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dashboard</title>
</head>
<body>
<nav class="nav">
    <a href = "{{url_for('dashboard', userid=userid)}}">Dashboard</a>
    <a href = "{{url_for('user_summary')}}">Summary</a>
    <a href = "{{url_for('home')}}">Logout</a>
</nav>
{% if details %}
<h1>Welcome, {{ details[0][2] }}</h1>
<h5>Spots Already Used: {{ details[0][5] }}</h5>
<h5>Spots In Use: {{ details[0][6] }}</h5>
{% else %}
<h1>Welcome, {{ session.Fname or 'User' }}</h1>
<h5>Spots Already Used: 0</h5>
<h5>Spots In Use: 0</h5>
{% endif %}
    <h3>Bookings In Progress</h3>


<table border="1">
    {% if details %}
        <table class="table table-bordered table-striped">
            <thead class="table-dark">
                <tr>
                    <th>Booking ID</th>
                    <th>Vehicle Number</th>
                    <th>User ID</th>
                    <th>Spot ID</th>
                    <th>Address</th>
                    <th>Pin Code</th>
                    <th>Status</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Price/Hour (â‚¹)</th>
                    <th>Duration (sec)</th>
                </tr>
            </thead>
            <tbody>
                {% for row in details %}
                <tr>
                    <td>{{ row[0] }}</td>
                    <td>{{ row[1] }}</td>
                    <td>{{ row[2] }}</td>
                    <td>{{ row[3] }}</td>
                    <td>{{ row[4] }}</td>
                    <td>{{ row[5] }}</td>
                    <td>{{ row[6] }}</td>
                    <td>{{ row[7] }}</td>
                    <td>{{ row[8] or 'Ongoing' }}</td>
                    <td>{{ row[9] }}</td>
                    <td>
                <form method="post" action="{{ url_for('reservation_details', spotid=row[3]) }}">
                    <button type="submit">
                      IN PROGRESS
                    </button>
                </form>
            </td>
                    <td>{{ row[10] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="alert alert-info">No booking records found.</div>
        {% endif %}


</table>
    <div class="text-center">
        <a href="{{ url_for('booking_history_user', userid=userid) }}" class="btn btn-primary"> View Completed Booking</a>
    </div>
    <div class="text-center">
        <a href="{{ url_for('booking_history_user_all', userid=userid) }}" class="btn btn-primary"> View Parking History</a>
    </div>



<!--lots-->
    <h3>Lots You Can Book</h3>
<table border="1">
    <tr>
        <th>Lot ID</th>
        <th>Address</th>
        <th>Pincode</th>
        <th>Price (Per hr)</th>
        <th>Max Number of Parking Spots</th>
        <th>Time Stamp</th>
        <th>Free Spots</th>
    </tr>
    {% for lot in lots %}
    <tr>
            <td>{{ lot[0] }}</td>
            <td>{{ lot[1] }}</td>
            <td>{{ lot[2] }}</td>
            <td>{{ lot[3] }}</td>
            <td>{{ lot[4] }}</td>
            <td>{{ lot[5] }}</td>
            <td>{{ lot[6] }}</td>
            {% if lot[6] > 0 %}
            <td>
                <form method="post" action="{{ url_for('book_lot', lotid=lot[0]) }}">
                    <button type="submit">
                      BOOK SPOTS
                    </button>
                </form>
            </td>
            {% else %}
            <td>
                <form>
                    <button type="button" disabled>
                      UNAVAILABLE
                    </button>
                  </form>
            </td>
            {% endif %}
    </tr>
    {% endfor %}
</table>

</body>
</html>